---
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";
import type { RenderedContent } from "astro:content";
import { splitArrayByElement } from "@utils/data";
import PostInfo from "./PostInfo.astro";

type Props = {
    post: CollectionEntry<"posts">;
};

type ModifiedFrontmatter = {
    readingTime: number;
};

const { post } = Astro.props;
const path = `/${post.collection}/${post.id}`;

const rendered = post.rendered as RenderedContent;
const readingTime = (rendered.metadata?.frontmatter as ModifiedFrontmatter)
    .readingTime;

const preview = splitArrayByElement(
    post.rendered?.html.split("\n")!,
    "<!--more-->",
).preview.join("");
---

<div class="card">
    <div class="card-content">
        <div class="card-link">
            <a href={path}>{post.data.title}</a>
        </div>
        <PostInfo post={post}/>
        <div class="card-description" set:html={preview} />
    </div>
    <a class="card-button" href={path}>
        <Icon name="fa6-solid:chevron-right" />
    </a>
</div>
