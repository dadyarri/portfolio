---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import formatDate from "@/utils/formatDate";
import "@/styles/til.css";
import MarkdownIt from "markdown-it";

const tils = await getCollection("tils");
const parser = new MarkdownIt();
---

<Layout title="TIL">
  <main class="flex flex-col gap-20">
    <h1 class="text-2xl dark:text-neutral-100">TIL — Сегодня я узнал</h1>

    <article class="flex flex-col gap-4">
      {
        tils?.length > 0 &&
          tils.map((til) => {
            return (
              <div class="flex w-full items-center justify-between border-t border-neutral-700 py-4">
                <div class="flex flex-col gap-3">
                  <div class="flex justify-between max-w-full">
                    <div class="flex items-center gap-4">
                      <h2 class="text-lg">{til.data.title}</h2>
                      <span>
                        {til.data.tags.map((tag) => (
                          <span class="dark:bg-neutral-800 dark:text-neutral-50 bg-neutral-100 rounded-md p-1 mx-1 text-[0.7rem]">
                            {tag}
                          </span>
                        ))}
                      </span>
                    </div>
                    <div class="flex flex-row items-center">
                      <p>{formatDate(til.data.publishedAt)}</p>
                    </div>
                  </div>

                  <div class="flex">
                    <div set:html={til.data.brief} />
                  </div>

                  {til.data.source && (
                    <a
                      href={til.data.source}
                      class="text-orange-500 underline"
                      target="_blank"
                    >
                      <div class="flex gap-2">
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 18 18"
                          fill="none"
                          class="transition-all duration-300 group-hover:translate-x-1"
                        >
                          <path
                            d="M5.25 12.75L12.75 5.25"
                            stroke="#999999"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                          <path
                            d="M5.25 5.25H12.75V12.75"
                            stroke="#999999"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                        {new URL(til.data.source).hostname}
                      </div>
                    </a>
                  )}
                </div>
              </div>
            );
          })
      }
    </article>
  </main>
</Layout>
